# ğŸ¾ PetClinic Dev

Spring PetClinic Microservices ì†ŒìŠ¤ ì½”ë“œ ë° CI/CD íŒŒì´í”„ë¼ì¸

## ğŸ›ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Gateway                            â”‚
â”‚                      (Port 8080)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     â”‚                     â”‚
    â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Customers  â”‚     â”‚   Visits   â”‚       â”‚    Vets    â”‚
â”‚  Service   â”‚     â”‚  Service   â”‚       â”‚  Service   â”‚
â”‚ (Port 8081)â”‚     â”‚ (Port 8082)â”‚       â”‚ (Port 8083)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                â”‚                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                   â”‚ MySQL (RDS) â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§© ì„œë¹„ìŠ¤ êµ¬ì„±

| ì„œë¹„ìŠ¤ | í¬íŠ¸ | ì„¤ëª… |
|--------|------|------|
| config-server | 8888 | ì¤‘ì•™ ì„¤ì • ê´€ë¦¬ |
| discovery-server | 8761 | Eureka ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ |
| api-gateway | 8080 | API ë¼ìš°íŒ… |
| customers-service | 8081 | ê³ ê°/í« ê´€ë¦¬ |
| visits-service | 8082 | ë°©ë¬¸ ê¸°ë¡ ê´€ë¦¬ |
| vets-service | 8083 | ìˆ˜ì˜ì‚¬ ì •ë³´ ê´€ë¦¬ |
| admin-server | 9090 | Spring Boot Admin |

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
â”œâ”€â”€ .github/workflows/
â”‚   â””â”€â”€ petclinic-ci.yml  # GitHub Actions CI/CD íŒŒì´í”„ë¼ì¸
â”œâ”€â”€ spring-petclinic-*/       # ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì†ŒìŠ¤
â”œâ”€â”€ docker/                   # Dockerfileë“¤
â”œâ”€â”€ scripts/                  # ë¹Œë“œ/ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ docker-compose.yml        # ë¡œì»¬ ê°œë°œìš©
â””â”€â”€ pom.xml                   # Maven ë£¨íŠ¸ ì„¤ì •
```

## ğŸš€ ë¡œì»¬ ì‹¤í–‰

```bash
# ì „ì²´ ë¹Œë“œ
./mvnw clean install -DskipTests

# Docker Composeë¡œ ì‹¤í–‰
docker-compose up -d

# ê°œë³„ ì„œë¹„ìŠ¤ ì‹¤í–‰
./mvnw spring-boot:run -pl spring-petclinic-config-server
```

## âš™ï¸ CI/CD (GitHub Actions)

`.github/workflows/petclinic-ci.yml` íŒŒì´í”„ë¼ì¸:

```
Push to main
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ë³€ê²½ ê°ì§€                                                â”‚
â”‚    â””â”€â”€ git diffë¡œ ìˆ˜ì •ëœ ì„œë¹„ìŠ¤ë§Œ ì‹ë³„                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. Maven ë¹Œë“œ (ë³€ê²½ëœ ì„œë¹„ìŠ¤ë§Œ)                             â”‚
â”‚    â””â”€â”€ Java 17, í…ŒìŠ¤íŠ¸ ìŠ¤í‚µ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. Docker Build & ECR Push                                 â”‚
â”‚    â”œâ”€â”€ ë ˆì´ì–´ë“œ ì´ë¯¸ì§€ (ìºì‹± ìµœì í™”)                        â”‚
â”‚    â””â”€â”€ íƒœê·¸: Git SHA (abc123)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4. GitOps ì—…ë°ì´íŠ¸                                          â”‚
â”‚    â”œâ”€â”€ petclinic-gitops í´ë¡                                â”‚
â”‚    â”œâ”€â”€ yqë¡œ kustomization.yaml ì •í™•í•œ íƒœê·¸ ìˆ˜ì •            â”‚
â”‚    â””â”€â”€ Commit & Push                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 5. ArgoCD ìë™ ë°°í¬                                         â”‚
â”‚    â””â”€â”€ petclinic-gitops ë³€ê²½ ê°ì§€ â†’ EKS ë°°í¬               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì„ íƒì  ë¹Œë“œ

| ë³€ê²½ íŒŒì¼ | ë¹Œë“œ ëŒ€ìƒ |
|----------|----------|
| `spring-petclinic-api-gateway/*` | api-gatewayë§Œ |
| `spring-petclinic-customers-service/*` | customers-serviceë§Œ |
| `pom.xml` ë˜ëŠ” `.github/workflows/*` | ì „ì²´ ì„œë¹„ìŠ¤ |

### GitHub Secrets ì„¤ì •

| Secret | ìš©ë„ |
|--------|------|
| `AWS_ROLE_ARN` | OIDC ì¸ì¦ìš© IAM Role |
| `GITOPS_TOKEN` | petclinic-gitops ë ˆí¬ ì ‘ê·¼ìš© PAT |

### yqë¥¼ ì‚¬ìš©í•œ ì •í™•í•œ íƒœê·¸ ìˆ˜ì •

```bash
# kustomization.yamlì—ì„œ íŠ¹ì • ì´ë¯¸ì§€ íƒœê·¸ë§Œ ìˆ˜ì •
yq -i '(.images[] | select(.name == "petclinic-api-gateway")).newTag = "abc123"' kustomization.yaml
```

## ğŸ³ Docker ì´ë¯¸ì§€

### ë ˆì´ì–´ë“œ ë¹Œë“œ (Dockerfile)
```dockerfile
FROM eclipse-temurin:17-jre-alpine
WORKDIR /app

# ì˜ì¡´ì„± ë ˆì´ì–´ (ìºì‹±)
COPY --from=builder /app/target/dependencies/ ./
COPY --from=builder /app/target/spring-boot-loader/ ./
COPY --from=builder /app/target/snapshot-dependencies/ ./

# ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆì´ì–´
COPY --from=builder /app/target/application/ ./

ENTRYPOINT ["java", "org.springframework.boot.loader.launch.JarLauncher"]
```

### ECR ë¦¬í¬ì§€í† ë¦¬

| ì„œë¹„ìŠ¤ | ECR URI |
|--------|---------|
| config-server | `{account}.dkr.ecr.ap-northeast-2.amazonaws.com/petclinic-config-server` |
| api-gateway | `{account}.dkr.ecr.ap-northeast-2.amazonaws.com/petclinic-api-gateway` |
| ... | ... |

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

| ë¶„ë¥˜ | ê¸°ìˆ  |
|------|------|
| Language | Java 17 |
| Framework | Spring Boot 3.x, Spring Cloud |
| Build | Maven |
| Container | Docker |
| Database | MySQL 8.0 (RDS) |
| CI/CD | GitHub Actions |
| GitOps | ArgoCD + Kustomize |
| YAML ì²˜ë¦¬ | yq (ì •í™•í•œ ì´ë¯¸ì§€ íƒœê·¸ ìˆ˜ì •) |
| AWS ì¸ì¦ | OIDC (í‚¤ ì—†ìŒ) |

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### Maven ë¹Œë“œ ì‹¤íŒ¨
```bash
# ìºì‹œ ì‚­ì œ í›„ ì¬ë¹Œë“œ
./mvnw clean install -U -DskipTests
```

### Docker ë¹Œë“œ ì‹œ ë©”ëª¨ë¦¬ ë¶€ì¡±
```bash
# Docker ë©”ëª¨ë¦¬ ì¦ê°€ ë˜ëŠ”
MAVEN_OPTS="-Xmx512m" ./mvnw package
```

### ECR Push ê¶Œí•œ ì˜¤ë¥˜
```bash
# OIDC Roleì— ECR ê¶Œí•œ í™•ì¸
aws ecr get-login-password --region ap-northeast-2 | docker login --username AWS --password-stdin {account}.dkr.ecr.ap-northeast-2.amazonaws.com
```

## ğŸ”— ì—°ê´€ ì €ì¥ì†Œ

| ì €ì¥ì†Œ | ì„¤ëª… |
|--------|------|
| **petclinic-gitops** | ì• í”Œë¦¬ì¼€ì´ì…˜ GitOps (Kustomize) |
| **platform-gitops** | í”Œë«í¼ ì»´í¬ë„ŒíŠ¸ (ALB Controller, Karpenter ë“±) |
| **platform-dev** | Terraform ì¸í”„ë¼ (EKS, RDS, VPC) |